---
output: html_document
editor_options: 
  chunk_output_type: console
---

# Federal policies to address housing insecurity

```{r}
#| label: setup
#| include: false
source(here::here("r", "libraries.r"))
source(here::here("r", "functions.r"))
source(here::here("r", "constants.r"))

dfbhere <- here::here("data", "fedbud")
dlihtc <- here::here("data", "hud", "lihtc")
dpict <- here::here("data", "hud", "picture")

budauth <- readRDS(path(dfbhere, "budauth.rds"))
outlay <- readRDS(path(dfbhere, "outlay.rds"))

lihtc <- readRDS(path(dlihtc, "lihtc.rds"))

nypicture <- readRDS(path(dpict, "nypicture.rds"))
picture <- readRDS(path(dpict, "picture.rds"))

```

## Introduction[^federal-1]

[^federal-1]: This section draws heavily on @mccartyOverviewFederalHousing2019.

The federal government has been involved in housing assistance since the 1930s, but the federal role has changed considerably over time. Current federal policies to address housing insecurity fall into three broad categories:

-   **Rental housing assistance**, including vouchers and other mechanisms to reduce monthly costs of private housing; federally subsidized public housing owned and operated by local public housing authorities (PHAs); and special programs for the elderly and disabled, and to support rural housing;
-   **Assistance to state and local governments**, including low-income housing tax credits the federal government allocates to states, and Community Development Block Grants (CDBG), and several other housing-related grants;
-   **Assistance for homeowners**, including federally insured mortgage loans and rural housing support.

Most of these policies are administered by the Department of Housing and Urban Development (HUD), but several are administered by other federal agencies, particularly the U.S. Department of the Treasury and the U.S. Department of Agriculture (USDA).

Federal housing assistance was boosted dramatically in each of the last two recessions (the 2007 housing bubble and Great Recession, and the 2020 Covid-19 recession). Increases were far smaller in the 1990 and 2001 recessions. (figure below)


```{r}
#| label: ONETIME-deflator
#| eval: false

# get deflator OMB used in the FFY 2023 budget

dftab <- r"(E:\data\FederalBudget\2023\BUDGET-2023-TAB\xls)"
fn <- "BUDGET-2023-TAB-2-3.xlsx"

df1 <- read_excel(path(dftab, fn))
# note that deflator is 1 in 2012, we want it to be 1 in 2022

df2 <- df1 |> 
  select(fyear=1, deflator=8) |> 
  mutate(fyear=str_sub(fyear, 1, 4) |> as.integer()) |>
  filter(fyear %in% 1990:2027) |> 
  mutate(deflator=as.numeric(deflator),
         ideflator=deflator[fyear==2022] / deflator)
saveRDS(df2, here::here("data", "fedbud", "deflator.rds"))


# https://fred.stlouisfed.org/series/GDPCTPI
# gdppi <- fredr(
#   series_id = "GDPCTPI",
#   observation_start = as.Date("1980-01-01"),
#   observation_end = NULL # as.Date("2000-01-01")
#   )

```



```{r}
#| label: countercyclical
#| include: true

deflator <- readRDS(here::here("data", "fedbud", "deflator.rds"))

pdata <- budauth |> 
  filter(subfuncode=="604") |> 
  group_by(fyear) |> 
  summarise(n=n(), budauth=sum(budauth), .groups="drop") |> 
  filter(fyear %in% 1990:2027) |> 
  left_join(deflator |> select(fyear, ideflator), by="fyear") |> 
  mutate(rbudauth=budauth * ideflator)

capt1 <- "Recession periods are shaded. Amounts for FFY 2023 and later are budget proposals."
capt2 <- "Source: Federal Budget FFY 2023: Federal Database and Historical Table 2.3" 
capt <- paste0(capt1, "\n", capt2)

p <- pdata |> 
  ggplot(aes(fyear, rbudauth)) +
  geom_line(colour="blue") +
  geom_point(colour="blue", size=0.75) +
  geom_band(recdata(pdata$fyear)) +
  scale_y_continuous(name="Authorization (billions of 2022 dollars)",
                     breaks=seq(0, 2e8, 2.5e7),
                     labels = dollar_format(scale=1e-6),
                     limits=c(0, NA)) +
  scale_x_continuous(name="Federal fiscal year", breaks=seq(1990, 2030, 5)) +
  ggtitle("Federal budget authorization for housing assistance") +
  labs(caption=capt) +
  theme_bw() +
  caption_left

p

```

There have been two major trends in federal housing assistance since the 1980s:

1.    The direct federal role in **creating** assisted housing has been declining, while the state and local government role has been increasing. This reflects the end to new construction under project-based Section 8, as well as the creation of the LIHTC.
2.    Shift to tenant-based assistance; project-based rental assistance contracts between private landlords and HUD began expiring in 1980s

To come (not sure where yet) table that shows major federal, state, and local programs, their size, and which housing insecurity issues they address.

Among other things, table will show (and text will describe) the extent to which spending policies are focused on renters. (Will note that if we consider housing policies more broadly, including mortgage interest deduction and now-limited property tax deduction, more money actually goes to homeowners.)


*Make sure to cover: far more eligible than served, long waiting lists.*


## Rental assistance

[Discuss:
tenant-based vs. project-based rental assistance, and pros and cons of each
rising role of tenant-based assistnce
]

### Overview of federal programs that provide housing assistance to low-income renters

```{r}


```




### Tenant-based rental assistance (Section 8 Housing Choice Vouchers)

### Project-based rental assistance

### Public housing

Map of public housing developments \[just a placeholder for now\]

![](images/image-1962356329.png)

### Projects targeted toward the elderly and disabled

Elderly section 202 projects \[again, just a placeholder\]

![](images/image-1830231498.png)

Section 811 projects for the disabled

![](images/image-69299167.png)

## Assistance to state and local governments

### Low income housing tax credit

LIHTC properties are spread far more broadly through the state than public housing. \[just a placeholder\]

![](images/image-114005822.png)

Low Income Housing Tax Credit-supported units by county

```{r rows.print=65}
#| label: lihtc
#| include: true

lihtc |> 
  mutate(n_units=ifelse(li_units > n_units, li_units, n_units)) |> 
  group_by(stcnty, county) |> 
  summarise(across(c(n_units, li_units), ~ sum(.x, na.rm=TRUE)), .groups = "drop") |> 
  mutate(lipct=li_units / n_units) |> 
  arrange(desc(li_units))

```

### Issues

## Assistance for homeowners

### CDBG and HOME grants

The Community Development Block Grant (CDBG), and HOME Investments Partnership Program (HOME) are federal block grants distributed (via formula) to states and local governments. Recipients use the grant funds to carry out housing, economic development, and public improvement efforts that serve low, and moderate-income communities. Approximately 3,300 properties in NY have benefited from these grants.

![](images/image-369821993.png)

## Beneficiaries of housing assistance

### HUD-subsidized households in the nation and state

only 1 in 5 households that qualify for housing assistance gets it (https://www.urban.org/research/publication/case-more-not-less-shortfalls-federal-housing-assistance-and-gaps-evidence-proposed-policy-changes)




```{r}
glimpse(picture)

picture |> 
  filter(nygeotype=="nation") |> 
  select(program, programf, people_total, hh_income,
         pct_female_head,	pct_female_head_child)

picture |> 
  filter(nygeotype=="nation") |> 
  select(program, programf, people_total, hh_income,
         pct_disabled_lt62,	pct_disabled_ge62, pct_disabled_all)

picture |> 
  filter(nygeotype=="state", stabbr=="NY") |> 
  select(program, programf, people_total, hh_income,
         pct_female_head,	pct_female_head_child)

picture |> 
  filter(nygeotype=="state", stabbr=="NY") |> 
  select(program, programf, people_total, hh_income,
         pct_disabled_lt62,	pct_disabled_ge62, pct_disabled_all)

pct_lt24_head
picture |> 
  filter(nygeotype=="state", stabbr=="NY") |> 
  select(program, programf, people_total, hh_income,
         pct_lt24_head, starts_with("pct_age"))

picture |> 
  filter(nygeotype=="state", stabbr=="NY") |> 
  select(program, programf, people_total, hh_income,
         pct_minority:pct_multi)

picture |> 
  filter(nygeotype=="state", stabbr=="NY") |> 
  select(program, programf, people_total, hh_income,
         pct_black_nonhsp, pct_white_nothsp, pct_hispanic)

picture |> 
  filter(nygeotype=="state", stabbr=="NY") |> 
  select(program, programf, people_total, hh_income,
         months_waiting, months_from_movein)

picture |> 
  filter(nygeotype=="state", stabbr=="NY") |> 
  select(program, programf, people_total, hh_income,
         tpoverty, tminority)

picture |> 
  filter(nygeotype=="county", stabbr=="NY", program==1) |> 
  select(geoid, shortname, programf, total_units, people_total, hh_income,
         tpoverty, tminority) |> 
  mutate(pctny=people_total / sum(people_total, na.rm=TRUE)) |> 
  arrange(desc(people_total))

picture |> 
  filter(nygeotype=="county", stabbr=="NY", program==1) |> 
  select(geoid, shortname, programf, total_units, people_total, hh_income,
         pct_black_nonhsp, pct_white_nothsp, pct_hispanic) |> 
  arrange(desc(pct_white_nothsp))

picture |> 
  filter(nygeotype=="county", stabbr=="NY", program==1) |> 
  select(geoid, shortname, programf, total_units, people_total, hh_income,
          pct_movein, months_waiting, months_from_movein) |> 
  arrange(desc(months_waiting))


picture |> 
  filter(nygeotype=="county", stabbr=="NY", program==1) |> 
  select(geoid, shortname, programf, total_units, people_total, hh_income,
          pct_movein, months_waiting, months_from_movein) |> 
  ggplot(aes(months_from_movein, pct_movein)) +
  geom_point()

picture |> 
  filter(nygeotype=="county", stabbr=="NY", program==1, !str_detect(geoname, "Missing")) |> 
  select(geoid, shortname, geoname, programf, total_units, people_total, hh_income,
          pct_movein, months_waiting, months_from_movein) |> 
  mutate(geoname=str_remove(geoname, " County")) |> 
  ggplot(aes(months_waiting, pct_movein)) +
  geom_point(colour="blue") +
  geom_text_repel(aes(label=geoname), size=3.5, nudge_y=0.5) +
  theme_bw()

picture |> 
  filter(nygeotype=="county", stabbr=="NY", program==1, !str_detect(geoname, "Missing")) |> 
  select(geoid, shortname, geoname, programf, total_units, people_total, hh_income,
          pct_movein, months_waiting, months_from_movein) |> 
  mutate(geoname=str_remove(geoname, " County")) |> 
  ggplot(aes(months_from_movein, months_waiting)) +
  geom_point(colour="blue") +
  geom_text_repel(aes(label=geoname), size=3.5, nudge_y=0.5) +
  theme_bw()


picture |>  
  group_by(program, programf) |> 
  summarise(across(c(people_total), ~ sum(.x, na.rm=TRUE)), .groups = "drop")

picture |>  
  group_by(stabbr, program, programf) |> 
  summarise(across(c(people_total), ~ sum(.x, na.rm=TRUE)), .groups = "drop")

```



### HUD-subsidized households in NY in 2021

```{r}
#| label: nypicture
#| include: true

# nypicture
# count(dfny, code, name) # 63: 57 xnyc, 5 nyc, 1 missing 36XXX

# nypicture |> 
#   group_by(program, program_label) |> 
#   summarise(across(c(people_total), ~ sum(.x, na.rm=TRUE)), .groups = "drop")

nypicture |> 
  group_by(nyc, program, program_label) |> 
  summarise(across(c(people_total), ~ sum(.x, na.rm=TRUE)), .groups = "drop") |> 
  pivot_wider(names_from=nyc, values_from=people_total, values_fill = 0)

```


HUD-subsidized households by county

```{r}
#| label: nycounties
#| include: true

shortlab <- c("all", "pubhousing", "hcv", "modrehab", "projbased", "bmir", "elderly", "disabled")

nypicture |> 
  mutate(shortlab=factor(program, levels=c(1:5, 7:9), labels=shortlab),
         shortlab=fct_other(shortlab, 
                            drop=c("modrehab", "bmir"),
                            other_level="other"),
         code=ifelse(nyc=="nyc", "36NYC", code),
         name=ifelse(nyc=="nyc", "New York City", name)) |> 
  group_by(name, shortlab) |> 
  summarise(across(c(people_total), ~ sum(.x, na.rm=TRUE)), .groups = "drop") |> 
  pivot_wider(names_from=shortlab, values_from=people_total, values_fill = 0) |> 
  mutate(diff=all - rowSums(across(-c(all, name))),
         other=other + diff,
         phpct=pubhousing / all) |> 
  select(-diff) |> 
  relocate(phpct, .after = all) |>
  arrange(desc(phpct))
```


