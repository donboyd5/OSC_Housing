## Housing Crowding

Living in overcrowded housing can lead to poor mental health, food insecurity, and infectious diseases such as Meningitis, Hepatitis, and Tuberculosis; overcrowding can have negative effects on neighborhoods as well. [@officeofdiseasepreventionandhealthpromotionQualityHousingLiterature2022], [@blakeMeasuringOvercrowdingHousing2007]

The most commonly used measure of overcrowding is persons-per-room in a dwelling unit. [@blakeMeasuringOvercrowdingHousing2007] This measure includes all rooms in a dwelling unit in the denominator, not just bedrooms. The number of persons per room generally will be lower than the number of persons per bedroom. One reason persons-per-room is used so commonly is that it can be computed readily using important data sources such as the American Community Survey (ACS) and the American Housing Survey. It is available in a crucially important data source prepared by the U.S. Department of Housing and Urban Development (HUD) known as Comprehensive Housing Affordability Strategy (CHAS), which is used in developing housing polices. HUD develops CHAS data using detailed nonpublic ACS data, 

There is no universally accepted threshold of persons-per-room above which a housing unit is considered crowded. Some studies have used a cutoff of 1 person per room, some have used a cutoff of 1.5 persons, and others have used different thresholds depending on specific health risks being examined. An important review conducted for HUD by Econometrica, Inc. used a cutoff of 1 person per room. [@blakeMeasuringOvercrowdingHousing2007] Crowding measures based on alternative thresholds tend to be highly correlated. In the analysis below we calculate the percentage of housing units in New York and other areas that are crowded using a threshold of 1 person per room.


```{r}
#| include: false

source(here::here("r", "libraries.r"))
source(here::here("r", "functions.r"))
source(here::here("r", "constants.r"))

chdir <- here::here("data", "chas")
chdir2019 <- path(chdir, "2015-2019")


t10 <- readRDS(path(chdir2019, "t10long.rds"))

crowd_wide <- t10 |> 
  filter(hhi=="allhhi", fam=="allfam") |> 
  # filter(nytype=="state", stabbr=="NY") |> # uncomment for testing
  pivot_wider(names_from = c(tenure, ppr)) |> 
  # get own and rent sums where cost burden is computable
  mutate(own_check=own_pprle1 + own_pprgt1le1p5 + own_pprgt1p5,
         rent_check=rent_pprle1 + rent_pprgt1le1p5 + rent_pprgt1p5,
         own_crowd=own_pprgt1le1p5 + own_pprgt1p5,
         rent_crowd=rent_pprgt1le1p5 + rent_pprgt1p5,
         alltenure_crowd=own_crowd + rent_crowd) |> 
  relocate(own_check, rent_check, .after=cntyname) |> 
  # calc percentages based on ppr > 1
  mutate(own_pct=own_crowd / own_allppr,
         rent_pct=rent_crowd / rent_allppr,
         alltenure_pct=alltenure_crowd / alltenure_allppr,
         renter_share=rent_allppr / alltenure_allppr)

# tabdata for all types
# nytype groups: state, region, county, city, town, village
tabdata <- crowd_wide |> 
  filter(nytype %in% c("state", "region", "county", "city", "town", "village")) |>
  group_by(nytype) |> 
  mutate(ownrank=row_number(desc(own_pct)),
         rentrank=row_number(desc(rent_pct)),
         alltenurerank=row_number(desc(alltenure_pct)))  |> 
  select(nytype, stabbr, mininame, cntyname, 
         allunits=alltenure_allppr,
         own_pct, rent_pct, alltenure_pct, 
         ownrank, rentrank, alltenurerank,
         renter_share) |> 
  ungroup() |> 
  arrange(desc(alltenure_pct))

```


```{r}
#| label: constants-crowding
#| include: false

minunits <- 500
nplaces <- 25

tabst <- "Percent of occupied housing units with more than 1 person per room"

```


### Housing-unit Crowding in New York and Other States

```{r}
#| label: state-crowding-data
#| include: false

tabdata_st <- tabdata |> 
  filter(nytype=="state", !stabbr %in% c("DC", "PR")) |> 
  mutate(mininame=str_remove(mininame, " State"))

```


New York has the fourth highest crowding rate among the states, measured by the percentage of households with more than 1 person per room on average. This is driven by New York's #4 rank for renters, and its high percentage of households that are renters (not shown).

```{r}
#| label: state-crowding-table
#| include: true
#| echo: false

tt <- "States ranked by housing unit crowding"
tab <- f_tabranks(tabdata_st, stubvar="mininame", stubhead="State",
         tabtitle=tt, tabsubtitle=tabst)

tabfile <-  path(tabdir, "crowd_states.png")
gtsave(tab, tabfile, zoom=2, expand=20)
# {{< include ../../_gt_snippet.qmd >}}

```

{{< include ../../_gt_snippet.qmd >}}

### Housing-unit Crowding in New York's Regions

```{r}
#| label: region-crowding-data
#| include: false

tabdata_rgn <- tabdata |> 
  filter(stabbr=="NY", nytype %in% c("state", "region")) |>  
  mutate(across(contains("rank"), ~ ifelse(nytype=="state", NA_real_, .x)))

tabdata_rgn

```


```{r}
#| label: region-crowding-table
#| include: true
#| echo: false

tt <- "New York regions ranked by housing unit crowding"
tab <- f_tabranks(tabdata_rgn, stubvar="mininame", stubhead="Region",
         tabtitle=tt)
tabfile <-  path(tabdir, "crowd_regions.png")
gtsave(tab, tabfile, zoom=2, expand=20)
# {{< include ../../_gt_snippet.qmd >}}

```

{{< include ../../_gt_snippet.qmd >}}


### Housing-unit Crowding in New York's Counties

```{r}
#| label: county-crowding-data
#| include: false

tabdata_cnty <- tabdata |> 
  filter(stabbr=="NY", nytype %in% c("state", "county")) |>  
  mutate(across(contains("rank"), ~ ifelse(nytype=="state", NA_real_, .x)))

tabdata_cnty

```

```{r}
#| label: county-crowding-table
#| include: true
#| echo: false
tt <- "Counties in New York ranked by housing unit crowding"
tab <- f_tabranks(tabdata_cnty, stubvar="mininame", stubhead="County",
         tabtitle=tt, tabsubtitle=tabst)
tabfile <-  path(tabdir, "crowd_counties.png")
gtsave(tab, tabfile, zoom=2, expand=20)
# {{< include ../../_gt_snippet.qmd >}}

```

{{< include ../../_gt_snippet.qmd >}}


### Housing-unit Crowding in New York's Cities

```{r}
#| label: city-crowding-data
#| include: false

tabdata_city <- tabdata |> 
  filter(stabbr=="NY", nytype %in% c("state", "city")) |>  
  mutate(across(contains("rank"), ~ ifelse(nytype=="state", NA_real_, .x)))

tabdata_city


```

```{r}
#| label: city-crowding-table
#| include: true
#| echo: false

tt <- "Cities in New York ranked by housing-unit crowding"
tab <- f_tabranks(tabdata_city, stubvar="mininame", stubhead="City",
         tabtitle=tt, tabsubtitle=tabst, keepcounty = TRUE)
tabfile <-  path(tabdir, "crowd_cities.png")
gtsave(tab, tabfile, zoom=2, expand=20)
# {{< include ../../_gt_snippet.qmd >}}

```

{{< include ../../_gt_snippet.qmd >}}

### Housing-unit Crowding in New York's Towns

There are more than 500 towns in New York, many of which are quite small. The table below ranks towns with at least 500 occupied housing units by the percentage of households with housing costs that have more than one person per room.

```{r}
#| label: town-crowding-data
#| include: false

tabdata_town <- tabdata |> 
  filter(stabbr=="NY", nytype %in% c("state", "town"))  |> 
  filter(allunits >= minunits) |> 
  # rerank dropping excluded units
  group_by(nytype) |> 
  mutate(ownrank=row_number(desc(own_pct)),
         rentrank=row_number(desc(rent_pct)),
         alltenurerank=row_number(desc(alltenure_pct))) |> 
  ungroup() |> 
  filter(row_number() <= nplaces) |>  
  mutate(across(contains("rank"), ~ ifelse(nytype=="state", NA_real_, .x)))

tabdata_town

```

```{r}
#| label: town-crowding-table
#| include: true
#| echo: false

tt <- paste0("Towns in New York with ",
             minunits, 
             "+ housing units and greatest housing-unit crowding")
tab <- f_tabranks(tabdata_town, stubvar="mininame", stubhead="Town",
         tabtitle=tt, tabsubtitle=tabst, keepcounty = TRUE)
tabfile <-  path(tabdir, "crowd_towns.png")
gtsave(tab, tabfile, zoom=2, expand=20)
# {{< include ../../_gt_snippet.qmd >}}

```

{{< include ../../_gt_snippet.qmd >}}

### Housing-unit Crowding in New York's Villages

There are more than 500 villages in New York, many of which are quite small. The table below ranks villages with at least 500 occupied housing units by the percentage of households with housing costs that have more than one person per room.

```{r}
#| label: village-crowding-data
#| include: false

tabdata_village <- tabdata |> 
  filter(stabbr=="NY", nytype %in% c("state", "village"))  |> 
  filter(allunits >= minunits) |> 
  # rerank dropping excluded units
  group_by(nytype) |> 
  mutate(ownrank=row_number(desc(own_pct)),
         rentrank=row_number(desc(rent_pct)),
         alltenurerank=row_number(desc(alltenure_pct))) |> 
  ungroup() |> 
  filter(row_number() <= nplaces) |>  
  mutate(across(contains("rank"), ~ ifelse(nytype=="state", NA_real_, .x)))

tabdata_village

```

```{r}
#| label: village-crowding-table
#| include: true
#| echo: false

tt <- paste0("Villages in New York with ",
             minunits, 
             "+ housing units and greatest housing-unit crowding")
tab <- f_tabranks(tabdata_village, stubvar="mininame", stubhead="Village",
         tabtitle=tt, tabsubtitle=tabst, keepcounty = TRUE)
tabfile <-  path(tabdir, "crowd_villages.png")
gtsave(tab, tabfile, zoom=2, expand=20)
# {{< include ../../_gt_snippet.qmd >}}

```

{{< include ../../_gt_snippet.qmd >}}

<!-- ### Who lives in crowded housing? -->

<!-- \[To come - breakdowns by income and race\] -->
